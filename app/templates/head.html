{% extends "master.html" %}

{% block subTitle %}{{map.title|escape}}{% endblock %}

{% block head %}
<script>

function Loaded()
{
	document.getElementById("comment").focus();
}

function DeleteComment(id)
{
	if (confirm("Are you sure you want to delete this comment?"))
		window.location.href = '/comment/delete?cid=' + id;
}

function Click()
{
	if (window.parent && window.parent.Click)
		window.parent.Click();
}

window.onclick = Click;
</script>
{% endblock %}

{% block body %}

<div id="info-status">
	<p>{% if username %}
		<a target="_top" href="/user/{{username}}" title="{{username}}'s activity">{{username}}</a> |
	   {% endif %}
		<a target="_top" href="{{map.Href}}" title="Close Frame">Close</a>
		<a target="_top" href="{{map.Href}}" title="Close Frame"><img class="x" src="/images/x.png"/></a></p>
	<p>Shared: {{map.shareCount}}</p>
	<p>Viewed: {{map.viewCount}}</p>
	<p>Comments: {{map.CommentCount}}</p>
	<p>Tags: 
	{% for tag in TopTags %}
		<a target="_top" href="/tag/{{tag}}" title="Recently popular | {{tag}}">{{tag|escape}}</a>{% if not forloop.last %}, {% endif %}
	{% endfor %}
	</p>
</div> <!-- info-status -->

<div id="info-body">
<a target="_top" href="/" title="G02.ME Home | Popular Pages"><img class="logo-small" src="/images/logo-small.png"></a>
<h1><a target="_top" href="{{map.Href}}" title="{{map.url|escape}}">{{map.title|escape}}</a></h1>
<p class="url">{{map.url|escape}}</p>

<div id="info-form">
  <form action="/comment/" method="get">
  <input type="hidden" name="id" value="{{map.GetId}}"/>
  <table><tr>
    {% if not username %}
      <td><label for="username">Nickname: </label></td>
      <td><input style="width:70px;" type="text" id="username" name="username"/></td>
    {% endif %}
    <td><label for="comment">Comment: </label></td>
  	<td style="width:100%"><input type="text" id="comment" name="comment"/></td>
  	<td style="width:5px;">&nbsp;</td>
    <td><input type="submit" value="Post"/></td>
  </tr></table>
  <p class="help">Comment format: "nickname: text of your comment [tag1, tag2, ...]"</p>
  </form>
</div>

<div class="comments">
{% for comment in map.Comments %}
	{% spaceless %}<p>
    {% if comment.username %}<a target="_top" href="/user/{{comment.username}}" title="{{comment.username}}'s activity">{{comment.username}}</a>:{% endif %}
    {{comment.comment|escape|urlize}}
    {% if comment.tags %}
    	[{% for tag in comment.TagList %}<a target="_top" href="/tag/{{tag}}" title="{{tag}} pages">{{tag}}</a>{% if not forloop.last %}, {% endif %}{% endfor %}]
    {% endif %}
    - {{ comment.Age }}
    {% if comment.AllowDelete %}
    <img class="x" onclick="DeleteComment({{comment.key.id}});" src="/images/x.png"/>
    {% endif %}
    </p>{% endspaceless %}
{% endfor %}
</div>

</div> <!-- info-body -->

{% endblock %}

{% block footer %}{%endblock %}
