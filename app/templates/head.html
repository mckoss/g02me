{% extends "master.html" %}
{% block head %}
<script>

function Loaded()
{
	document.getElementById("comment").focus();
}

function CloseFrame()
{
	window.top.open("{{map.url}}");
}

function DeleteComment(id)
{
	if (confirm("Are you sure you want to delete this comment?"))
		window.location.href = '/comment/delete?cid=' + id;
}

function Click()
{
	if (window.parent && window.parent.Click)
		window.parent.Click();
}

window.onclick = Click;
</script>
{% endblock %}
{% block subTitle %}{{map.title|escape}}{% endblock %}
{% block body %}
<a target="_top" href="/"><img class="logo" src="/images/logo.png"></a>

<div class="ur">
<a target="_top" href="{{map.url}}">Close</a> <img class="x" onclick="CloseFrame();" src="/images/x.png"/>
<p>Viewed: {{map.viewCount}}</p>
<p>Shared: {{map.shareCount}}</p>
<p>Comments: {{map.CommentCount}}</p>
<p>Tags: 
{% for tag in TopTags %}
	<a target="_top" href="/tag/{{tag}}">{{tag|escape}}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}
</p>
</div>

<h1><a target="_top" href="{{map.url}}">{{map.title|escape}}</a></h1>
<p>{{map.url|escape}}</p>

<div class="entry">
  <form action="/comment/" method="get">
  <input type="hidden" name="id" value="{{map.GetId}}"/>
  <label for="comment">Comment: </label>
  <input style="width:500px;" type="text" id="comment" name="comment" value="{% if username %}{{username|escape}}: {% endif %}"/>&nbsp;<input type="submit" value="Post"/>
  <br/><i>Example: "username: what do you think of this page [tag1, tag2, ...]"</i>
  </form>
</div>

<div class="comments">
{% for comment in map.Comments %}
	{% spaceless %}<p>
    {% if comment.username %}<a target="_top" href="/user/{{comment.username}}">{{comment.username|escape}}</a>:{% endif %}
    {{comment.comment|escape|urlize}}
    {% if comment.tags %}
    	[{% for tag in comment.TagList %}<a target="_top" href="/tag/{{tag}}">{{tag|escape}}</a>{% if not forloop.last %}, {% endif %}{% endfor %}]
    {% endif %}
    <img class="x" onclick="DeleteComment({{comment.key.id}});" src="/images/x.png"/>
    </p>{% endspaceless %}
{% endfor %}
</div>

{% endblock %}
